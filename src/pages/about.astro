---
import Layout from '../components/Layout.astro';
import GrowLoyaltySection from '../components/GrowLoyaltySection.astro';
import { useTranslations } from '../i18n/utils';
import LottieFlag from '../components/LottieFlag.astro';

// Default to English for the main about page
const t = useTranslations('en');
---
---

<Layout title="About Us - American Loyalty" currentPage="about">
	<!-- HERO SECTION -->
	<section class="relative bg-brand-blue">
		<div class="px-4 pt-16 pb-8 mx-auto max-w-7xl sm:px-6 lg:px-8 lg:pt-24 lg:pb-12">
			<div class="flex flex-col items-center gap-8 lg:gap-[41px]">
				<!-- Text Content -->
				<div class="flex flex-col items-center text-center">
					<h1 class="font-inter font-semibold text-white text-4xl sm:text-5xl md:text-6xl lg:text-7xl xl:text-[87px] leading-[1.36] tracking-tight lg:tracking-[-3px] mb-2 about-hero-title" data-hero-animation>
						{t('about.hero.title')}
					</h1>
					<p class="font-inter font-medium text-white text-sm sm:text-base md:text-lg lg:text-xl xl:text-[21.7px] leading-[1.36] tracking-tight about-hero-subtitle mb-[10px]" data-hero-animation>
						{t('about.hero.subtitle')}
					</p>
				</div>
				
				<!-- Hero Image -->
				<div class="w-full about-hero-image" data-hero-animation>
					<div 
						class="w-full aspect-[16/9] rounded-lg lg:rounded-xl overflow-hidden about-hero-img-container"
						style="position: relative; top: 130px; margin-top: -130px;"
						data-parallax
					>
						<iframe 
							src="https://www.youtube.com/embed/NLtnXSHV1lw?si=vNFW4WONAXfrrKEk&autoplay=1&mute=1&controls=0&loop=1&playlist=NLtnXSHV1lw&modestbranding=1&rel=0&playsinline=1" 
							class="w-full h-full"
							allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
							referrerpolicy="strict-origin-when-cross-origin"
							allowfullscreen
							style="border:0;"
						></iframe>
					</div>
				</div>
			</div>
		</div>
	</section>

    <!-- Spacer for floating image effect; match next section background to avoid white gap -->
    <div class="h-16 bg-gray-100 lg:h-20"></div>

	<!-- MAIN CONTENT SECTION -->
    <section class="py-16 bg-gray-100 lg:py-24">
		<div class="px-4 mx-auto max-w-7xl sm:px-6 lg:px-8">
			<!-- Built on Loyalty Section -->
        <div class="grid gap-12 items-start mb-16 lg:grid-cols-2 lg:gap-36 lg:mb-24 about-loyalty-section" data-animation="staggered">
          <div>
            <div class="about-loyalty-title">
              <h2 class="mb-6 text-3xl font-bold leading-tight text-gray-900 font-archivo sm:text-4xl lg:text-5xl xl:text-6xl" set:html={t('about.loyalty_section.title')}></h2>
            </div>
            <div class="mt-2 about-loyalty-text">
              <p class="text-lg font-medium leading-relaxed text-gray-600 font-inter">
                With over 20 years of experience, we specialize in creating high-quality, engaging, and meaningful rewards that connect brands with millions of consumers. Our proven success in the Latin American retail market has prepared us to enter the U.S. with confidence. We help our partners achieve measurable sales growth while building long-lasting relationships with loyal, happy customers.
              </p>
            </div>
          </div>
          <div class="flex justify-center about-loyalty-flag lg:justify-end">
            <LottieFlag width={600} height={400} className="sm:max-w-[480px]" />
          </div>
        </div>

			<!-- STATISTICS SECTION -->
			<div class="flex flex-col gap-8 justify-center items-center lg:flex-row lg:gap-0 about-stats-container" data-animation="staggered" data-delay="200">
				<div class="flex-1 text-center about-stat-item">
					<div class="mb-2 text-4xl font-semibold font-outfit text-brand-red lg:text-5xl xl:text-6xl count-number" data-animation="countUp" data-end-value="10">0</div>
					<div class="text-lg font-normal text-gray-900 font-inter lg:text-xl xl:text-2xl">{t('about.stats.countries_served')}</div>
				</div>
				
				<!-- Vertical divider -->
				<div class="hidden mx-8 w-px h-16 bg-gray-300 lg:block about-divider"></div>
				<div class="my-4 w-12 h-px bg-gray-300 lg:hidden about-divider"></div>
				
				<div class="flex-1 text-center about-stat-item">
				<div class="mb-2 text-4xl font-semibold font-outfit text-brand-red lg:text-5xl xl:text-6xl count-number" data-animation="countUp" data-end-value="150000000">0</div>
					<div class="text-lg font-normal text-gray-900 font-inter lg:text-xl xl:text-2xl">{t('about.stats.customers_reached')}</div>
				</div>
				
				<!-- Vertical divider -->
				<div class="hidden mx-8 w-px h-16 bg-gray-300 lg:block about-divider"></div>
				<div class="my-4 w-12 h-px bg-gray-300 lg:hidden about-divider"></div>
				
				<div class="flex-1 text-center about-stat-item">
					<div class="mb-2 text-4xl font-semibold font-outfit text-brand-red lg:text-5xl xl:text-6xl count-number" data-animation="countUp" data-end-value="20">0</div>
					<div class="text-lg font-normal text-gray-900 font-inter lg:text-xl xl:text-2xl">{t('about.stats.years_experience')}</div>
				</div>
				
				<!-- Vertical divider -->
				<div class="hidden mx-8 w-px h-16 bg-gray-300 lg:block about-divider"></div>
				<div class="my-4 w-12 h-px bg-gray-300 lg:hidden about-divider"></div>
				
				<div class="flex-1 text-center about-stat-item">
					<div class="mb-2 text-4xl font-semibold font-outfit text-brand-red lg:text-5xl xl:text-6xl count-number" data-animation="countUp" data-end-value="300">0</div>
					<div class="text-lg font-normal text-gray-900 font-inter lg:text-xl xl:text-2xl">{t('about.stats.collectibles_delivered')}</div>
				</div>
			</div>
		</div>
	</section>

	<!-- OUR HISTORY SECTION -->
	<section class="py-16 bg-gray-100 lg:py-24">
		<div class="px-4 mx-auto max-w-6xl sm:px-6 lg:px-8">
			<div class="mb-12 text-center lg:mb-16 about-history-header" data-animation="fadeIn">
				<h2 class="mb-4 text-3xl font-bold text-gray-900 font-archivo sm:text-4xl lg:text-5xl xl:text-6xl">{t('about.history.title')}</h2>
				<p class="mx-auto max-w-lg text-lg font-medium text-gray-600 font-inter">
					{t('about.history.description')}
				</p>
			</div>

			<div class="grid gap-8 md:grid-cols-3 about-history-cards" data-animation="staggered" data-delay="200">
				<!-- Card 1 -->
				<div class="p-8 bg-white rounded-2xl shadow-lg about-history-card">
					<div class="flex justify-center items-center mb-6 w-14 h-14 rounded-lg bg-brand-red about-card-icon">
						<svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
						</svg>
					</div>
					<h3 class="mb-3 text-xl font-semibold text-gray-900 font-poppins">{t('about.history.cards.0.title')}</h3>
					<p class="font-normal text-gray-600 opacity-70 font-poppins">{t('about.history.cards.0.description')}</p>
				</div>

				<!-- Card 2 -->
				<div class="p-8 bg-white rounded-2xl shadow-lg about-history-card">
					<div class="flex justify-center items-center mb-6 w-14 h-14 rounded-lg bg-brand-red about-card-icon">
						<svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
						</svg>
					</div>
					<h3 class="mb-3 text-xl font-semibold text-gray-900 font-poppins">{t('about.history.cards.1.title')}</h3>
					<p class="font-normal text-gray-600 opacity-70 font-poppins">{t('about.history.cards.1.description')}</p>
				</div>

				<!-- Card 3 -->
				<div class="p-8 bg-white rounded-2xl shadow-lg about-history-card">
					<div class="flex justify-center items-center mb-6 w-14 h-14 rounded-lg bg-brand-red about-card-icon">
						<svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
						</svg>
					</div>
					<h3 class="mb-3 text-xl font-semibold text-gray-900 font-poppins">{t('about.history.cards.2.title')}</h3>
					<p class="font-normal text-gray-600 opacity-70 font-poppins">{t('about.history.cards.2.description')}</p>
				</div>
			</div>
		</div>
	</section>

	<!-- VISION AND MISSION SECTION -->
	<section class="py-16 bg-white lg:py-24">
		<div class="px-4 mx-auto max-w-7xl sm:px-6 lg:px-8">
			<div class="grid gap-8 items-start lg:grid-cols-2 lg:gap-12 about-vision-mission" data-animation="staggered">
				<!-- Vision Section -->
				<div class="flex flex-col gap-8 about-vision">
					<div class="flex flex-col gap-6">
						<div class="text-lg font-bold tracking-wide font-archivo text-brand-red lg:text-2xl xl:text-3xl about-vision-label">{t('about.vision.label')}</div>
						<h2 class="text-3xl font-bold leading-tight text-gray-900 capitalize font-archivo sm:text-4xl lg:text-4xl xl:text-5xl about-vision-title">
							{t('about.vision.title')}
						</h2>
					</div>
					<div class="aspect-[4/3] bg-gray-200 rounded-lg overflow-hidden about-vision-image">
					<img 
							src="/img/iStock-2221917240.jpg"
							alt={t('about.vision.image_alt')}
							class="object-cover w-full h-full"
						/>
					</div>
				</div>

				<!-- Mission Section -->
				<div class="flex flex-col gap-8 about-mission">
					<div class="aspect-[4/3] bg-gray-200 rounded-lg overflow-hidden about-mission-image">
					<img 
						src="https://images.unsplash.com/photo-1600880292203-757bb62b4baf?ixlib=rb-4.0.3&auto=format&fit=crop&w=1000&q=80"
						alt={t('about.mission.image_alt')}
						class="object-cover w-full h-full"
					/>
					</div>
					<div class="flex flex-col gap-6">
						<div class="text-lg font-bold tracking-wide font-archivo text-brand-red lg:text-2xl xl:text-3xl about-mission-label">{t('about.mission.label')}</div>
						<h2 class="text-3xl font-bold leading-tight text-gray-900 capitalize font-archivo sm:text-4xl lg:text-4xl xl:text-5xl about-mission-title">
							{t('about.mission.title')}
						</h2>
					</div>
				</div>
			</div>
		</div>
	</section>

	<!-- CALL TO ACTION SECTION -->
	<GrowLoyaltySection t={t} />
</Layout>

<script>
	import { gsap } from 'gsap';
	import { ScrollTrigger } from 'gsap/ScrollTrigger';

	gsap.registerPlugin(ScrollTrigger);

	// Wait for DOM to be ready
    document.addEventListener('DOMContentLoaded', () => {
		// Prevent FOUC - set initial visibility immediately
		document.body.style.visibility = 'visible';
		
		// Set initial states for animations with proper FOUC prevention
		// Use CSS transforms instead of direct property manipulation to avoid layout shifts
		gsap.set('.about-hero-title', { 
			opacity: 0, 
			y: 30,
			willChange: 'transform, opacity'
		});
		gsap.set('.about-hero-subtitle', { 
			opacity: 0, 
			y: 20,
			willChange: 'transform, opacity'
		});
		gsap.set('.about-hero-image', { 
			opacity: 0, 
			y: 50, // Reduced from 350 to prevent dramatic shifts
			scale: 0.98, // More subtle scale
			willChange: 'transform, opacity'
		});
		
    	// Initialize fade left/right elements with minimal transform to prevent layout shifts
		gsap.set('.about-loyalty-title', { 
			opacity: 0, 
			x: -30, // Reduced from -50 to minimize layout impact
			willChange: 'transform, opacity'
		});
		gsap.set('.about-loyalty-text', { 
			opacity: 0, 
			x: 30, // Reduced from 50 to minimize layout impact
			willChange: 'transform, opacity'
		});
        gsap.set('.about-loyalty-flag', {
          opacity: 0,
          y: 20,
          willChange: 'transform, opacity'
        });
		
		// Stats and other elements
		gsap.set('.about-stat-item', { 
			opacity: 0, 
			y: 20, // Reduced transform distance
			scale: 0.95, // More subtle scale
			willChange: 'transform, opacity'
		});
		gsap.set('.about-divider', { 
			opacity: 0, 
			scaleY: 0,
			willChange: 'transform, opacity'
		});
		gsap.set('.about-history-header', { 
			opacity: 0, 
			y: 30, // Reduced from 50
			willChange: 'transform, opacity'
		});
		gsap.set('.about-history-card', { 
			opacity: 0, 
			y: 30, // Reduced from 50
			rotationY: 8, // Reduced from 15
			willChange: 'transform, opacity'
		});
		gsap.set('.about-card-icon', { 
			scale: 0, 
			rotation: -20, // Reduced rotation
			willChange: 'transform'
		});
		
		// Vision/Mission sections with minimal transform
		gsap.set('.about-vision', { 
			opacity: 0, 
			x: -50, // Keep original but add containment
			willChange: 'transform, opacity'
		});
		gsap.set('.about-mission', { 
			opacity: 0, 
			x: 50, // Keep original but add containment
			willChange: 'transform, opacity'
		});
		
		// Image scaling effects
		gsap.set('.about-vision-image img', { 
			scale: 1.1, // Reduced from 1.2
			willChange: 'transform'
		});
		gsap.set('.about-mission-image img', { 
			scale: 1.1, // Reduced from 1.2
			willChange: 'transform'
		});

		// Hero entrance animation with improved timing
		const heroTl = gsap.timeline({ delay: 0.2 }); // Reduced delay for faster perception
		
		heroTl
			.to('.about-hero-title', {
				opacity: 1,
				y: 0,
				duration: 0.6, // Slightly faster
				ease: 'power2.out', // Smoother easing
			})
			.to('.about-hero-subtitle', {
				opacity: 1,
				y: 0,
				duration: 0.5, // Faster
				ease: 'power2.out',
			}, '-=0.3') // Better overlap
			.to('.about-hero-image', {
				opacity: 1,
				y: 0,
				scale: 1,
				duration: 0.8,
				ease: 'power2.out',
			}, '-=0.2');

		// Optimized parallax effect for hero image
		gsap.to('.about-hero-img-container', {
			yPercent: -20, // Reduced parallax intensity
			ease: 'none',
			scrollTrigger: {
				trigger: '.about-hero-img-container',
				start: 'top bottom',
				end: 'bottom top',
				scrub: 1, // Smoother scrub
			}
		});

        // Built on Loyalty section - improved timing
		ScrollTrigger.create({
			trigger: '.about-loyalty-section',
			start: 'top 85%', // Trigger earlier
			onEnter: () => {
				gsap.to('.about-loyalty-title', {
					opacity: 1,
					x: 0,
					duration: 0.7,
					ease: 'power2.out',
				});
				gsap.to('.about-loyalty-text', {
					opacity: 1,
					x: 0,
					duration: 0.7,
					ease: 'power2.out',
					delay: 0.1, // Slight stagger
				});
            gsap.to('.about-loyalty-flag', {
              opacity: 1,
              y: 0,
              duration: 0.7,
              ease: 'power2.out',
              delay: 0.15,
            });
			}
		});

		// Statistics section - smoother reveal
		ScrollTrigger.create({
			trigger: '.about-stats-container',
			start: 'top 85%',
			onEnter: () => {
				// Animate stat items with improved stagger
				gsap.to('.about-stat-item', {
					opacity: 1,
					y: 0,
					scale: 1,
					duration: 0.5, // Faster
					ease: 'back.out(1.4)', // Less dramatic bounce
					stagger: 0.06, // Faster stagger
				});

				// Animate dividers
				gsap.to('.about-divider', {
					opacity: 1,
					scaleY: 1,
					duration: 0.4,
					ease: 'power2.out',
					stagger: 0.06,
					delay: 0.1,
				});

				// Optimized count-up animations
				document.querySelectorAll('.count-number').forEach((element, index) => {
					const endValue = parseInt(element.getAttribute('data-end-value'));
					const obj = { value: 0 };
					
					gsap.to(obj, {
						value: endValue,
						duration: 1.2, // Slightly faster
						ease: 'power2.out',
						delay: 0.2 + (index * 0.06),
						onUpdate: () => {
								if (endValue >= 1000000) {
									const millions = (obj.value / 1000000);
									element.textContent = `${Number.isInteger(millions) ? millions.toFixed(0) : millions.toFixed(1)}M+`;
								} else {
								element.textContent = `${Math.round(obj.value)}${endValue >= 100 ? '+' : ''}`;
							}
						}
					});
				});
			}
		});

		// History section header
		ScrollTrigger.create({
			trigger: '.about-history-header',
			start: 'top 85%',
			onEnter: () => {
				gsap.to('.about-history-header', {
					opacity: 1,
					y: 0,
					duration: 0.6,
					ease: 'power2.out',
				});
			}
		});

		// History cards with improved 3D effect
		ScrollTrigger.create({
			trigger: '.about-history-cards',
			start: 'top 85%',
			onEnter: () => {
				gsap.to('.about-history-card', {
					opacity: 1,
					y: 0,
					rotationY: 0,
					duration: 0.6,
					ease: 'power2.out',
					stagger: 0.12,
				});

				gsap.to('.about-card-icon', {
					scale: 1,
					rotation: 0,
					opacity: 1,
					duration: 0.5,
					ease: 'back.out(1.5)',
					stagger: 0.12,
					delay: 0.15,
				});
			}
		});

		// Optimized card hover effects
		document.querySelectorAll('.about-history-card').forEach(card => {
			card.addEventListener('mouseenter', () => {
				gsap.to(card, {
					y: -8, // Reduced movement
					scale: 1.01, // More subtle scale
					duration: 0.15, // Faster response
					ease: 'power2.out',
				});
				gsap.to(card.querySelector('.about-card-icon'), {
					rotation: 3, // Reduced rotation
					scale: 1.05, // Reduced scale
					duration: 0.15,
					ease: 'power2.out',
				});
			});

			card.addEventListener('mouseleave', () => {
				gsap.to(card, {
					y: 0,
					scale: 1,
					duration: 0.15,
					ease: 'power2.out',
				});
				gsap.to(card.querySelector('.about-card-icon'), {
					rotation: 0,
					scale: 1,
					duration: 0.15,
					ease: 'power2.out',
				});
			});
		});

		// Vision and Mission section - contained animation
		ScrollTrigger.create({
			trigger: '.about-vision-mission',
			start: 'top 85%',
			onEnter: () => {
				gsap.to('.about-vision', {
					opacity: 1,
					x: 0,
					duration: 0.8,
					ease: 'power2.out',
				});
				gsap.to('.about-mission', {
					opacity: 1,
					x: 0,
					duration: 0.8,
					ease: 'power2.out',
					delay: 0.1,
				});
			}
		});

		// Reduced image zoom effects
		gsap.to('.about-vision-image img', {
			scale: 1,
			ease: 'none',
			scrollTrigger: {
				trigger: '.about-vision-image',
				start: 'top bottom',
				end: 'bottom top',
				scrub: 1,
			}
		});

		gsap.to('.about-mission-image img', {
			scale: 1,
			ease: 'none',
			scrollTrigger: {
				trigger: '.about-mission-image',
				start: 'top bottom',
				end: 'bottom top',
				scrub: 1,
			}
		});

		// Subtle floating animation for icons - reduced intensity
		gsap.to('.about-card-icon svg', {
			y: -2, // Reduced from -3
			duration: 3, // Slower for less distraction
			ease: 'power1.inOut',
			yoyo: true,
			repeat: -1,
			stagger: 0.5,
		});

		// Text reveal effects for section labels
		ScrollTrigger.batch('.about-vision-label, .about-mission-label', {
			onEnter: (elements) => {
				gsap.from(elements, {
					scaleX: 0,
					transformOrigin: 'left center',
					duration: 0.5, // Faster
					ease: 'power2.out',
					stagger: 0.06,
				});
			}
		});

        // Removed background parallax on sections to prevent visible gaps

		// Clean up will-change properties after animations complete
		const cleanupWillChange = () => {
			gsap.delayedCall(2, () => {
				document.querySelectorAll('[style*="will-change"]').forEach(el => {
					(el as HTMLElement).style.willChange = 'auto';
				});
			});
		};
		
		cleanupWillChange();
	});
</script>

<style>
	/* Prevent FOUC and ensure smooth initial state */
	body {
		visibility: hidden;
	}
	
	/* Pre-hide animated elements to prevent flashing */
	.about-hero-title,
	.about-hero-subtitle,
	.about-hero-image,
	.about-loyalty-title,
	.about-loyalty-text,
  .about-loyalty-flag,
	.about-stat-item,
	.about-divider,
	.about-history-header,
	.about-history-card,
	.about-card-icon,
	.about-vision,
	.about-mission {
		opacity: 0;
	}
	
	/* Ensure smooth animations and contain layout shifts */
	.about-hero-title,
	.about-hero-subtitle,
	.about-hero-image,
	.about-loyalty-title,
	.about-loyalty-text,
	.about-stat-item,
	.about-divider,
	.about-history-header,
	.about-history-card,
	.about-vision,
	.about-mission {
		will-change: transform, opacity;
	}
	
	/* Contain horizontal animations to prevent layout shifts */
	.about-loyalty-section,
	.about-vision-mission {
		overflow: hidden;
	}

	.about-history-card {
		transform-style: preserve-3d;
		backface-visibility: hidden;
	}

	.about-card-icon {
		will-change: transform;
	}

	.about-vision-image,
	.about-mission-image {
		overflow: hidden;
	}

	.about-vision-image img,
	.about-mission-image img {
		will-change: transform;
	}

	/* Smooth cursor interactions */
	.about-history-card {
		cursor: pointer;
		transition: box-shadow 0.3s ease;
	}

	.about-history-card:hover {
		box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
	}
</style> 